# ğŸ” Microservicio de AutenticaciÃ³n â€“ IAM

Este microservicio forma parte de una aplicaciÃ³n modular orientada a la gestiÃ³n de juegos de mesa. Desarrollado como parte del proyecto de fin de grado, este componente se encarga de gestionar el registro, inicio de sesiÃ³n y control de acceso de usuarios mediante Keycloak, siguiendo una arquitectura desacoplada y escalable.

---

## ğŸ“Œ CaracterÃ­sticas principales

- ğŸ” IntegraciÃ³n completa con [Keycloak](https://www.keycloak.org/) como proveedor de identidad
- âœ… ValidaciÃ³n de datos con [Joi](https://joi.dev/)
- ğŸ“¦ API RESTful construida con [Express.js](https://expressjs.com/)
- ğŸ§ª Testeado con [Vitest](https://vitest.dev/) y [Supertest](https://github.com/visionmedia/supertest)
- ğŸ“„ DocumentaciÃ³n con [Swagger UI](https://swagger.io/tools/swagger-ui/)
- ğŸ³ Preparado para ejecutarse en entornos Docker

---

## ğŸš€ TecnologÃ­as utilizadas

- **Node.js**
- **Express** como framework HTTP
- **Keycloak** para gestiÃ³n de identidades y roles
- **Joi** para validaciÃ³n de esquemas
- **Swagger (OpenAPI)** para documentaciÃ³n
- **Docker** para contenerizaciÃ³n
- **Vitest + Supertest** para pruebas unitarias y de integraciÃ³n

---

## ğŸ“ Estructura de carpetas

```bash
src/
â”œâ”€â”€ config/               # ConfiguraciÃ³n de Keycloak y sesiÃ³n
â”‚   â””â”€â”€ keycloak.js
â”œâ”€â”€ controllers/          # LÃ³gica de endpoints (register/login)
â”‚   â””â”€â”€ auth.controller.js
â”œâ”€â”€ middlewares/          # ValidaciÃ³n de datos con Joi
â”‚   â””â”€â”€ validate.js
â”œâ”€â”€ routes/               # DefiniciÃ³n de rutas de autenticaciÃ³n y roles
â”‚   â”œâ”€â”€ auth.routes.js
â”‚   â””â”€â”€ roles.routes.js
â”œâ”€â”€ services/             # Acceso a la API de Keycloak desde Node.js
â”‚   â””â”€â”€ keycloak.service.js
â”œâ”€â”€ validators/           # Esquemas Joi
â”‚   â””â”€â”€ auth.validator.js
â”œâ”€â”€ docs/                 # Swagger JSON para documentaciÃ³n OpenAPI
â”‚   â””â”€â”€ swagger.json
â”œâ”€â”€ server.js             # Punto de entrada de la app
â”œâ”€â”€ .env                  # Variables de entorno
â”œâ”€â”€ Dockerfile            # Imagen de Docker
â”œâ”€â”€ docker-compose.yml    # OrquestaciÃ³n de contenedor
â””â”€â”€ README.md             # DocumentaciÃ³n del microservicio
```

---

## ğŸš€ InstalaciÃ³n y uso local (para uso especifico del microservicio)
### 1. Clona el repositorio completo
``` bash
git clone https://github.com/alvarocille/ludokeeper.git
cd ludokeeper/backend/IAM
```
### 2. Crea los archivos de entorno
``` bash
cp .env.test .env
```
### 3. Instala las dependencias
``` bash
npm install
```
### 4. Lanza el microservicio y MongoDB con Docker
``` bash
docker-compose up --build
```
### 5. Accede a la API
#### Swagger UI:
http://localhost:3000/docs
#### Endpoint de ejemplo:
GET http://localhost:3000/auth/register

---

## ğŸ§ª Testing
Este microservicio incluye pruebas de validaciÃ³n y respuestas HTTP.
### Ejecutar pruebas
``` bash
npm run test
```

---

## ğŸ“˜ API REST

La API del microservicio estÃ¡ documentada automÃ¡ticamente con Swagger y accesible desde:

```
http://localhost:3000/docs
```

### Endpoints principales

| MÃ©todo | Ruta                 | DescripciÃ³n                                |
|--------|----------------------|--------------------------------------------|
| POST   | `/auth/register`     | Registra un nuevo usuario                  |
| POST   | `/auth/login`        | Inicia sesiÃ³n y devuelve un token JWT      |
| POST   | `/auth/refresh`      | Refresca el token JWT del usuario activo   |
| GET    | `/rol/admin`         | Ruta protegida, accesible solo por admins  |
| GET    | `/rol/jugador`       | Ruta protegida, accesible solo por jugadores |

> âš ï¸ Los endpoints protegidos requieren un JWT vÃ¡lido en el encabezado:
> ```
> Authorization: Bearer <token>
> ```

## ğŸ“„ Licencia

MIT Â© Ãlvaro Cilleruelo Sinovas

